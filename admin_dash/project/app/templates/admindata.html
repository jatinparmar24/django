{% extends "base.html" %}

{% block title %} Admin dashboard{% endblock %}

{% block content %}


  <section class="admindashborad">

    <div class="admin_tab">
     <a href="{% url 'add_emp' %}?show_form=1" class="create-employee-link">Create Employee</a> <br>
     <a href="{% url 'show_all_emp' %}" class="create-employee-link">Show Employee</a> <br>
     <a href="{% url 'admin_resumes' %}?show=true" class="create-employee-link">View All Resumes</a>

    </div>

{% if messages %}
  {% for message in messages %}
    <!-- <p style="color: {% if message.tags == 'success' %}green{% else %}red{% endif %};"> -->
      {{ message }}
    </p>
  {% endfor %}
{% endif %}

<!-- Form Section -->
{% if show_form %}
<div class="modern-form-container">
  <form method="post" enctype="multipart/form-data" action="{% url 'add_emp' %}" autocomplete="off">
    {% csrf_token %}

    <div class="form-group">
      <input type="text" name="name" required placeholder=" " />
      <label>Name</label>
    </div>

    <div class="form-group">
      <input type="tel" name="phone" required pattern="[0-9]{10}" placeholder=" " />
      <label>Phone</label>
    </div>

    <div class="form-group">
      <input type="date" name="dob" required min="1990-01-01" max="2020-01-01" placeholder=" " />
      <label>DOB</label>
    </div>

    <div class="form-group">
      <select name="emp_depart" required>
        <option value="" disabled selected hidden>Select Department</option>
        <option value="HR">Human Resources</option>
        <option value="IT">Information Technology</option>
        <option value="FIN">Finance</option>
        <option value="MKT">Marketing</option>
        <option value="OPS">Operations</option>
      </select>
      <label>Department</label>
    </div>

    <div class="form-group">
      <input type="email" name="email" required placeholder=" " />
      <label>Email</label>
    </div>

    <div class="form-group">
      <input type="password" name="password" required placeholder=" " />
      <label>Password</label>
    </div>

    <div class="form-group">
      <input type="file" name="profile-pic" accept=".jpg,.jpeg,.png" />
      <label class="file-label">Profile Picture</label>
    </div>

    <div class="form-action">
      <input type="submit" value="Register" />
    </div>
  </form>
</div>

{% endif %}

<!-- Employee Table Section -->
{% if show_all %}
  <table class="styled-table">
  <thead>
    <tr>
      <th>S.NO</th>
      <th>Name</th>
      <th>Contact</th>
      <th>DOB</th>
      <th>Email</th>
      <th>Department</th>
      <th>Profile</th>
      <th>Edit</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody>
    {% for i in emp_data %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ i.emp_name }}</td>
        <td>{{ i.emp_contact }}</td>
        <td>{{ i.emp_dob }}</td>
        <td>{{ i.emp_email }}</td>
        <td>{{ i.emp_depart}}</td>
        <td>
          {% if i.emp_image %}
            <img src="{{ i.emp_image.url }}" alt="Profile" width="50" height="50" style="object-fit: cover; border-radius: 50%;">
          {% else %}
            No Image
          {% endif %}
        </td>
        <td><a href="{% url 'edit_emp' i.id %}" class="edit-btn">Edit</a></td>
        <td><a href="{% url 'delete_employee' i.id %}" onclick="return confirm('Are you sure you want to delete this employee?');" class="delete-btn">Delete</a></td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endif %}

{% if edit_employee %}
<form action="{% url 'edit_emp' edit_employee.id %}" method="post" enctype="multipart/form-data" class="edit-employee-form">
  {% csrf_token %}

  <h2>Edit Employee Details</h2>

  <label>Name:</label>
  <input type="text" name="name" value="{{ edit_employee.emp_name }}" required>

  <label>Contact:</label>
  <input type="text" name="contact" value="{{ edit_employee.emp_contact }}" required>

  <label>DOB:</label>
  <input type="date" name="dob" value="{{ edit_employee.emp_dob|date:'Y-m-d' }}" required>

  <label>Email:</label>
  <input type="email" name="email" value="{{ edit_employee.emp_email }}" required>

  <label>Password:</label>
  <input type="text" name="pass" value="{{ edit_employee.emp_pass }}" required>

  <label>Current Profile Image:</label>
  {% if edit_employee.emp_image %}
    <img src="{{ edit_employee.emp_image.url }}" alt="Current Image" class="preview-img">
  {% else %}
    <p class="no-img-text">No profile image uploaded.</p>
  {% endif %}

  <label>Upload New Image:</label>
  <input type="file" name="image" accept="image/*">

  <input type="submit" value="Update" class="submit-btn">
</form>



{% endif %}

{% if admin_resumes %}
  <h2>Submitted Resumes</h2>
<table border="1" cellpadding="5" style="margin-bottom: 30px;">
  <tr>
    <th>S.NO</th>
    <th>Name</th>
    <th>Contact</th>
    <th>DOB</th>
    <th>Resume Info</th>
    <th>Profile Picture</th>
  </tr>

  {% for entry in resumes %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ entry.info_name }}</td>
      <td>{{ entry.info_contact }}</td>
      <td>{{ entry.info_dob }}</td>
      <td>{{ entry.info_resume }}</td>
      <td>
        {% if entry.info_image %}
          <img src="{{ entry.info_image.url }}" alt="Profile" width="50" height="50" style="object-fit: cover; border-radius: 50%;">
        {% else %}
          No Image
        {% endif %}
      </td>
    </tr>
  {% endfor %}
</table>

<h2>Manage Resumes</h2>

<table border="1" cellpadding="5">
  <tr>
    <th>Name</th>
    <th>Contact</th>
    <th>DOB</th>
    <th>Resume</th>
    <th>Profile Pic</th>
    <th>Admin Opinion</th>
    <th>Update Opinion</th>
  </tr>

  {% for r in resumes %}
  <tr>
    <td>{{ r.info_name }}</td>
    <td>{{ r.info_contact }}</td>
    <td>{{ r.info_dob }}</td>
    <td>{{ r.info_resume }}</td>
    <td>
      {% if r.info_image %}
        <img src="{{ r.info_image.url }}" width="50" height="50" style="object-fit: cover; border-radius: 50%;">
      {% else %}
        No Image
      {% endif %}
    </td>
    <td>{{ r.admin_opinion|default:"No opinion yet" }}</td>
    <td>
      <form method="post" style="margin:0;">
        {% csrf_token %}
        <input type="hidden" name="resume_id" value="{{ r.id }}">
        <textarea name="admin_opinion" rows="3" cols="30" placeholder="Add your opinion...">{{ r.admin_opinion }}</textarea><br>
        <button type="submit">Update</button>
      </form>
    </td>
  </tr>
  {% endfor %}
</table>


  
{% endif %}


</section>

{% endblock %}